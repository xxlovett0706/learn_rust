# 模块

## 什么是模块

1. 模块是一组语法项的集合
2. 模块化编程是一种软件设计思想，降低耦合，便于维护
3. 模块有不同的定义方式

### 可以使用 mod 关键字定义

```rust
mod math {
  type Complex = (f64, f64);
  fn sin(f: f64) -> f64 {
    /* ... */
    unimplemented!();
  }
  fn cos(f: f64) -> f64 {
    /* ... */
    unimplemented!();
  }
  fn tan(f: f64) -> f64 {
    /* ... */
    unimplemented!();
  }
}
```

### 可以定义于单个文件

```rust
// complex.rs

type Complex = (f64, f64);
fn sin(f: f64) -> f64 {
  /* ... */
  unimplemented!();
}
fn cos(f: f64) -> f64 {
  /* ... */
  unimplemented!();
}
fn tan(f: f64) -> f64 {
  /* ... */
  unimplemented!();
}
```

### 可以定义于多个文件

```rust
// member 模块

member/
    |____ mod.rs
    |____ name.rs
    |____ address.rs

// member 模块 **推荐使用**

member/
    |____ name.rs
    |____ address.rs
member.rs
```

## 多模块之间的关系

-   同级模块使用 crate 前缀
-   父级模块使用 super 前缀
-   包外模块之间使用包名

```rust
// member 模块
member/
    |____ name.rs
    |____ address.rs
member.rs

/*  -------- CODES -------- */
// user.rs
Struct User {
  name: String,
  address: String,
}

// member.rs
use crate::user::User;

// member/name.rs
// member/address.rs
user super::User;

// main.rs
fn main () {
  use serde::*;
}
```

## 模块的可见性

```rust
pub mod outer_mod {
    pub(self) fn outer_mod_fn() {}
    pub mod inner_mod {
        // 对外层模块 outer_mod 内部可见
        pub(in crate::outer_mod) fn outer_mod_visible_fn() {}

        // 对整个 crate 可见
        pub(crate) fn crate_visible_fn() {}
        // 对 outer_mod 内部可见
        pub(super) fn super_mod_visible_fn() {
            // 访问同一模块的函数
            inner_mod_visible_fn();
            // 访问父级模块的函数需要使用
            crate::outer_mod::outer_mod_fn();
        }
        // 仅在 inner_mod 内部可见
        pub(self) fn inner_mod_visible_fn() {}
    }

    pub fn foo() {
        inner_mod::outer_mod_visible_fn();
        inner_mod::crate_visible_fn();
        inner_mod::super_mod_visible_fn();

        // 不能使用 inner_mod 的私有函数
        // inner_mod::inner_mod_visible_fn();
    }
}

fn bar() {
    // 该函数对整个 crate 可见
    outer_mod::inner_mod::crate_visible_fn();

    // 该函数只对 outer_mod可见
    // outer_mod::inner_mod::super_mod_visible_fn();

    // 该函数只对 outer_mod可见
    // outer_mod::inner_mod::outer_mod_visible_fn();

    // 通过 foo 函数调用内部细节
    outer_mod::foo();
}

fn main() {
    bar();
}
```

## 模块与属性

### 修改路径

```rust
#[path = "foo.rs"]
mod c;

mod inline {
    #[path = "other.rs"]
    mod inner;
}

#[path = "thread_files"]
mod thread {
    // Load the `local_data` module from `thread_files/tls.rs` relative to this source file's directory
    #[path ="tls.rs"]
    mod local_data;
}

```

### 模块级属性

根据 `#` 号后有没有 `!`判断是否是全局属性

```rust
#![warn(clippy::pedantic)]
#![allow(clippy::filter_map)]

fn main() {
  // ...
}

#[allow(clippy::cmp_nan)]
fn foo() {
    // ...
}
```
